(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[153],{"../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oroemail/templates/email-attachment/email-attachment-item.html":(module,__unused_webpack_exports,__webpack_require__)=>{var _=__webpack_require__("./bundles/oroui/js/extend/underscore.js");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){if(__p+='<div data-id="'+(null==(__t=id)?"":_.escape(__t))+'" class="attachment-item-row">\n    <div class="attachment-item">\n        <span class="attachment-item__icon fa '+(null==(__t=icon)?"":_.escape(__t))+'" aria-hidden="true"></span>\n        <span class="attachment-item__filename ',errors.length&&(__p+="attachment-item__not-valid"),__p+='" title="'+(null==(__t=fileName)?"":_.escape(__t))+'">'+(null==(__t=fileName)?"":_.escape(__t))+'</span>\n        <button class="attachment-item__remove btn btn-icon btn-square-lighter" type="button" data-role="remove">\n            <span class="fa-close" aria-hidden="true"></span>\n        </button>\n    </div>\n    ',errors.length){__p+="\n        ";for(var i=0;i<errors.length;i++)__p+='\n            <ul class="attachment-item__errors">\n                <li><span>'+(null==(__t=errors[i])?"":_.escape(__t))+"</span></li>\n            </ul>\n        ";__p+="\n    "}__p+='\n    <div class="attachment-item__form-rest">\n        <input name="'+(null==(__t=inputName)?"":_.escape(__t))+"["+(null==(__t=cid)?"":_.escape(__t))+'][id]" type="text" value="'+(null==(__t=id)?"":_.escape(__t))+'"/>\n        <input name="'+(null==(__t=inputName)?"":_.escape(__t))+"["+(null==(__t=cid)?"":_.escape(__t))+'][type]" type="text" value="'+(null==(__t=type)?"":_.escape(__t))+'" class="attachment-type"/>\n        <input name="'+(null==(__t=inputName)?"":_.escape(__t))+"["+(null==(__t=cid)?"":_.escape(__t))+'][file]" class="no-uniform" type="file"/>\n    </div>\n</div>\n'}return __p}},"../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oroemail/templates/email-attachment/email-attachment-list-row-view.html":(module,__unused_webpack_exports,__webpack_require__)=>{var _=__webpack_require__("./bundles/oroui/js/extend/underscore.js");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="attachment-list-row ',visible||(__p+="hide"),__p+='">\n    <input type="checkbox" class="checkbox"',checked&&(__p+=" checked"),__p+='>\n    <a href="#"\n        ',preview&&(__p+='\n            data-toggle="popover"\n            data-content="<img src=\''+(null==(__t=preview)?"":_.escape(__t))+'\' width=\'110\' class=\'img-rounded\' alt=\'\' >"\n            data-placement="bottom"\n            data-class="attachment-preview-popover"\n            data-trigger="hover"\n            data-noscroll="1"\n        '),__p+="\n    >\n        "+(null==(__t=fileName)?"":_.escape(__t))+"\n    </a>\n    <span>("+(null==(__t=fileSize)?"":_.escape(__t))+", "+(null==(__t=modified)?"":_.escape(__t))+")</span>\n</div>\n";return __p}},"../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oroemail/templates/email-attachment/email-attachment-select-view.html":(module,__unused_webpack_exports,__webpack_require__)=>{var _=__webpack_require__("./bundles/oroui/js/extend/underscore.js");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="attachment-list-content">\n    <div class="filter-block">\n        <label>'+(null==(__t=_.__("oro.email.attachment.select_file"))?"":_.escape(__t))+'</label>\n        <input type="text" class="filter"/>\n    </div>\n    <div class="attachment-list">\n        <div class="no-items">\n            <p class="text-center">'+(null==(__t=_.__("oro.email.form.no_attachments"))?"":_.escape(__t))+'</p>\n        </div>\n        <div class="group-block entity-attachments">\n            <b>'+(null==(__t=_.__("oro.email.form.record_attachments"))?"":_.escape(__t))+'</b>\n            <div class="entity-attachments-list"></div>\n        </div>\n        <div class="group-block thread-attachments">\n            <b>'+(null==(__t=_.__("oro.email.form.thread_attachments"))?"":_.escape(__t))+'</b>\n            <div class="thread-attachments-list"></div>\n        </div>\n    </div>\n</div>\n<div class="clear"></div>\n<div class="attachment-actions">\n    <div class="pull-right">\n        <button type="button" class="btn cancel">'+(null==(__t=_.__("Cancel"))?"":_.escape(__t))+'</button>\n        <button type="button" class="btn btn-primary attach">'+(null==(__t=_.__("oro.email.form.attach"))?"":_.escape(__t))+"</button>\n    </div>\n</div>\n";return __p}},"../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oroemail/templates/email-notification/email-notification-collection-view.html":(module,__unused_webpack_exports,__webpack_require__)=>{var _=__webpack_require__("./bundles/oroui/js/extend/underscore.js");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){switch(__p+='<div class="content short-emails-list default-',defaultActionId){case 2:__p+="reply-action";break;case 3:__p+="forward-action";break;default:__p+="reply-all-action"}__p+='">\n',length>0?(__p+='\n    <div class="short-emails-list__header">\n        <a class="my-emails" href="'+(null==(__t=userEmailsUrl)?"":_.escape(__t))+'">\n            '+(null==(__t=_.__("oro.email.notification.user_emails.label"))?"":_.escape(__t))+"\n        </a>\n        ",countNewEmail&&(__p+="\n            ",hasMarkVisibleButton&&(__p+='\n            <button class="mark-visible-as-read btn btn-link">\n                <i class="fa-check-square-o"></i>\n                '+(null==(__t=_.__("oro.email.recent_emails_widget.mark_visible_read.label"))?"":_.escape(__t))+"\n            </button>\n            "),__p+="\n            ",hasMarkAllButton&&(__p+='\n            <button class="mark-as-read btn btn-link">\n                <i class="fa-check-square-o"></i>\n                '+(null==(__t=_.__("oro.email.notification.mark_read.label"))?"":_.escape(__t))+"\n            </button>\n            "),__p+="\n        "),__p+='\n    </div>\n    <ul class="items"></ul>\n    ',moreUnreadEmails&&(__p+='\n    <div class="more-unread">+'+(null==(__t=moreUnreadEmails)?"":__t)+" "+(null==(__t=_.__("oro.email.notification.more_unread"))?"":_.escape(__t))+"</div>\n    "),__p+="\n"):__p+='\n    <div class="empty">'+(null==(__t=_.__("oro.email.notification.empty"))?"":_.escape(__t))+"</div>\n",__p+="\n</div>\n"}return __p}},"../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oroemail/templates/email-notification/email-notification-icon-view.html":(module,__unused_webpack_exports,__webpack_require__)=>{var _=__webpack_require__("./bundles/oroui/js/extend/underscore.js");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<i class="mail-icon',unreadEmailsCount>0&&(__p+="  has-icon-counter highlight"),__p+='">\n    ',unreadEmailsCount>0&&(__p+='\n        <span class="item-counter">'+(null==(__t=unreadEmailsCount>99?"99+":unreadEmailsCount)?"":_.escape(__t))+"</span>\n    "),__p+="\n</i>\n";return __p}},"../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oroemail/templates/sidebar-widget/recent-emails/recent-emails-setup-view.html":(module,__unused_webpack_exports,__webpack_require__)=>{var _=__webpack_require__("./bundles/oroui/js/extend/underscore.js");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<fieldset class="recent-emails-setup form-vertical">\n    <div class="control-group">\n        <div class="control-label wrap">\n            <label class="required">'+(null==(__t=_.__("oro.email.recent_emails_widget.mailbox_folder"))?"":_.escape(__t))+'<em>*</em></label>\n        </div>\n        <div class="controls">\n            <input name="folderId" type="hidden" value="'+(null==(__t=settings.folderId)?"":_.escape(__t))+'" />\n        </div>\n    </div>\n    <div class="control-group">\n        <div class="control-label wrap">\n            <label class="required">'+(null==(__t=_.__("oro.email.recent_emails_widget.amount_of_emails"))?"":_.escape(__t))+'<em>*</em></label>\n        </div>\n        <div class="controls"><input type="text" name="limit" value="'+(null==(__t=settings.limit)?"":_.escape(__t))+'"/></div>\n    </div>\n    <div class="control-group">\n        <div class="control-label wrap">\n            <label class="required">\n                <i class="fa-info-circle tooltip-icon" data-content="'+(null==(__t=_.__("oro.email.recent_emails_widget.default_action_hint"))?"":_.escape(__t))+'" data-toggle="popover"></i>\n                '+(null==(__t=_.__("oro.email.recent_emails_widget.default_action"))?"":_.escape(__t))+'\n                <em>*</em>\n            </label>\n        </div>\n        <div class="controls">\n            <select name="defaultActionId"  class="select2">\n                <option',1==settings.defaultActionId&&(__p+=' selected="selected"'),__p+=' value="1">'+(null==(__t=_.__("oro.email.recent_emails_widget.reply_all"))?"":_.escape(__t))+"</option>\n                <option",2==settings.defaultActionId&&(__p+=' selected="selected"'),__p+=' value="2">'+(null==(__t=_.__("oro.email.recent_emails_widget.reply"))?"":_.escape(__t))+"</option>\n                <option",3==settings.defaultActionId&&(__p+=' selected="selected"'),__p+=' value="3">'+(null==(__t=_.__("oro.email.recent_emails_widget.forward"))?"":_.escape(__t))+"</option>\n            </select>\n        </div>\n    </div>\n</fieldset>\n";return __p}},"../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oroemail/templates/sidebar-widget/recent-emails/recent-emails-widget-title.html":(module,__unused_webpack_exports,__webpack_require__)=>{var _=__webpack_require__("./bundles/oroui/js/extend/underscore.js");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",settings.folderName?(__p+="\n    "+(null==(__t=settings.folderName)?"":_.escape(__t)),settings.mailboxName&&(__p+=" - "+(null==(__t=settings.mailboxName)?"":_.escape(__t))),__p+="\n"):__p+="\n    "+(null==(__t=title)?"":_.escape(__t))+"\n",__p+="\n";return __p}},"./bundles/oroemail/js/app/apply-template-confirmation.js":(e,t,i)=>{var o,n;o=[i("./bundles/oroui/js/extend/underscore.js"),i("./bundles/orotranslation/js/translator.js"),i("./bundles/oroui/js/modal.js")],void 0===(n=function(e,t,i){"use strict";const o=i.extend({className:"modal oro-modal-danger",_attributes:{role:"alertdialog"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(i){i=e.extend({title:t("oro.email.emailtemplate.apply_template_confirmation_title"),okText:t("Yes, Proceed"),cancelText:t("Cancel")},i),o.__super__.initialize.call(this,i)}});return o}.apply(t,o))||(e.exports=n)},"./bundles/oroemail/js/app/components/auto-response-rule-component.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/oroui/js/app/components/base/component.js").extend({relatedSiblingComponents:{conditionBuilderComponent:"condition-builder"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){if(!this.conditionBuilderComponent)throw new Error("Sibling component `conditionBuilderComponent` is required.");this.$definitionInput=t("[data-ftid=oro_email_autoresponserule_definition]"),this.conditionBuilderComponent.view.setValue(o.result(this.getValue(),"filters")),this.listenTo(this.conditionBuilderComponent.view,"change",this.setFiltersValue),n.__super__.initialize.call(this,e)},getValue:function(){const e=this.$definitionInput.val();return e.length?JSON.parse(e):{}},setFiltersValue:function(e){const t=this.getValue();t.filters=e,this.$definitionInput.val(JSON.stringify(t))},dispose:function(){this.disposed||(delete this.$definitionInput,n.__super__.dispose.call(this))}});return n}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/components/check-smtp-connection-component.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/oroui/js/app/components/base/component.js"),s=i("./bundles/oroemail/js/app/views/check-smtp-connection-view.js"),l=i("./bundles/oroemail/js/app/views/check-saved-smtp-connection-view.js"),a=i("./bundles/oroemail/js/app/models/check-smtp-connection-model.js");return n.extend({constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){if(e.elementNamePrototype){const i=o.extend({el:t(e._sourceElement).closest(e.parentElementSelector),entity:e.forEntity||"user",entityId:e.id,organization:e.organization||""},e.viewOptions||{});"saved"!==e.view?(i.model=new a({}),this.view=new s(i)):this.view=new l(i)}else t(e._sourceElement).remove()}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/components/email-attachment-component.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/app/components/base/component.js"),o=i("./bundles/oroemail/js/app/views/email-attachment-select-view.js"),n=i("./bundles/oroemail/js/app/models/email-attachment-collection.js"),s=i("./bundles/oroemail/js/app/views/email-attachment-collection-view.js"),l=t.extend({collection:null,collectionView:null,popupView:null,popupCollection:null,$uploadNewButton:null,$popupSelectButton:null,$popupContentEl:null,constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){this.popupCollection=new n(e.attachmentsAvailable||[]),this.collection=new n(e.entityAttachments||[]),this.collectionView=new s({collection:this.collection,el:e._sourceElement,listSelector:"#"+e.containerId,inputName:e.inputName,fileIcons:e.fileIcons}),this.$uploadNewButton=this.findControlElement(e._sourceElement,e.uploadNewButton),this.$popupSelectButton=this.findControlElement(e._sourceElement,e.popupTriggerButton),this.$popupContentEl=this.findControlElement(e._sourceElement,e.popupContentEl),this.$popupSelectButton.length&&this.$popupContentEl.length&&this.bindEvents(),this.$form=e._sourceElement.closest("form"),this.applyAttachmentValidation()},dispose:function(){if(!this.disposed)return this.$uploadNewButton.off("."+this.cid),this.$popupSelectButton.off("."+this.cid),this.$form.off("."+this.cid),l.__super__.dispose.call(this)},applyAttachmentValidation:function(){const e=this;this.$form.on("submit."+this.cid,(function(t){if(e.$form.find(".attachment-item__errors").length>0)return t.preventDefault(),!1}))},bindEvents:function(){const e=this;this.$popupSelectButton.on("click."+this.cid,(function(){const t=e.getPopupView();t.isShowed?t.hide():t.show()})),this.$uploadNewButton.on("click."+this.cid,(function(){e.collection.add({})}))},getPopupView:function(){if(!this.popupView){this.popupView=new o({el:this.$popupContentEl,collection:this.popupCollection,attachedCollection:this.collection}),this.popupView.showHideFilter(),this.popupView.showHideGroups();const e=this;this.popupCollection.on("attach",(function(){e.popupCollection.each((function(t){if(t.get("checked")){const i=t.clone();e.collection.add(i)}})),e.popupView.hide()}))}return this.popupView},findControlElement:function(e,t){return e.parent().find(t)}});return l}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/components/email-editor-component.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/app/components/base/component.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/oroemail/js/app/views/email-editor-view.js"),s=i("./bundles/oroemail/js/util/email-templates-provider.js"),l=i("./bundles/oroemail/js/app/models/email-editor-model.js"),a=i("./bundles/oroemail/js/app/models/email-model.js");return t.extend({options:{editorComponentName:"oro_email_email_body"},listen:{parentResize:"passResizeEvent"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){this.options=o.defaults(e||{},this.options),this._deferredInit(),this.view=new n({el:e._sourceElement,model:this.createEditorModelFromComponentOptions(e),templatesProvider:s,editorComponentName:this.options.editorComponentName}),this.view.render(),this.view.renderPromise.done((()=>{this._resolveDeferredInit()}))},createEditorModelFromComponentOptions:function(e){const t=e._sourceElement;return new l({appendSignature:e.appendSignature,isSignatureEditable:e.isSignatureEditable,signature:t.find('[name$="[signature]"]').val(),email:new a({subject:t.find('[name$="[subject]"]').val(),body:t.find('[name$="[body]"]').val(),type:t.find('[name$="[type]"]').val(),relatedEntityId:e.entityId,parentEmailId:t.find('[name$="[parentEmailId]"]').val(),cc:e.cc,bcc:e.bcc}),bodyFooter:t.find('[name$="[bodyFooter]"]').val()})},passResizeEvent:function(){this.view.pageComponent("wrap_"+this.options.editorComponentName).trigger("parentResize")}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/components/email-notification-component.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/underscore.js"),o=i("./bundles/oroui/js/extend/backbone.js"),n=i("./bundles/oroui/js/tools.js"),s=i("./bundles/oroui/js/app/components/base/component.js"),l=i("./bundles/oroemail/js/app/views/email-notification/email-notification-collection-view.js"),a=i("./bundles/oroemail/js/app/views/email-notification/mobile-email-notification-view.js"),r=i("./bundles/oroemail/js/app/views/email-notification/email-notification-count-view.js"),c=s.extend({view:null,collection:null,countModel:null,constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){if(t.extend(this,t.pick(e,["countModel"])),this.countModel instanceof o.Model==0)throw new TypeError('Invalid "countModel" option of EmailNotificationComponent');this.initViews(e)},initViews:function(e){const t=n.isMobile()?a:l;let i;this.view=new t({el:e.listSelector?e._sourceElement.find(e.listSelector):e._sourceElement,collection:this.collection,countNewEmail:this.countModel.get("unreadEmailsCount"),folderId:e.folderId,defaultActionId:e.defaultActionId,hasMarkAllButton:Boolean(e.hasMarkAllButton),hasMarkVisibleButton:Boolean(e.hasMarkVisibleButton)}),e.iconSelector&&(i=e._sourceElement.find(e.iconSelector)).length&&(this.countView=new r({el:i,model:this.countModel}))},dispose:function(){delete this.collection,delete this.countModel,c.__super__.dispose.call(this)}});return c}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/components/folder-tree-component.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/underscore.js"),o=i("./bundles/oroui/js/app/components/base/component.js"),n=i("./bundles/oroemail/js/app/views/email-folder-tree-view.js");return o.extend({emailFolderTreeView:null,requiredOptions:["dataInputSelector","checkAllSelector","relatedCheckboxesSelector"],constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){t.each(this.requiredOptions,(function(i){if(!t.has(e,i))throw new Error('Required option "'+i+'" not found.')})),this.emailFolderTreeView=new n({el:e._sourceElement,dataInputSelector:e.dataInputSelector,checkAllSelector:e.checkAllSelector,relatedCheckboxesSelector:e.relatedCheckboxesSelector})}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/components/mark-unread-button.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/orotranslation/js/translator.js"),s=i("./bundles/oroui/js/mediator.js"),l={successMessage:"oro.email.menu.mark_unread.success.message",errorMessage:"oro.email.menu.mark_unread.error.message",redirect:"/"};function a(e){e.preventDefault();const i=t(e.target).data("url");s.execute("showLoading"),t.post({url:i,errorHandlerMessage:n(l.errorMessage)}).done((function(){s.execute("showFlashMessage","success",n(l.successMessage)),s.execute("redirectTo",{url:l.redirect},{redirect:!0})})).always((function(){s.execute("hideLoading")}))}return function(e){o.extend(l,e||{}),l._sourceElement.click(a)}}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/components/new-email-flash-message-component.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/underscore.js"),o=i("./bundles/fosjsrouting/js/router.js"),n=i("./bundles/oroui/js/messenger.js");return i("./bundles/oroemail/js/app/components/new-email-message-component.js").extend({messageTpl:t.template('<%- _.__("oro.email.notification.new_email")%><span class="separator">|</span><a href="<%-url %>"><%- _.__("Read") %></a>'),constructor:function e(t){e.__super__.constructor.call(this,t)},onNewEmail:function(){const e=this.messageTpl({url:o.generate("oro_email_user_emails")});n.notificationFlashMessage("info",e)}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/components/new-email-message-component.js":(e,t,i)=>{var o;o=function(e,t,o){"use strict";const n=i("./bundles/oroui/js/extend/underscore.js"),s=i("./bundles/oroui/js/app/services/module-config.js").A(o.id),l=i("./bundles/orosync/js/sync.js");return i("./bundles/oroui/js/app/components/base/component.js").extend({onNewEmailDebounced:null,constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){const t=s.wsChannel;this.onNewEmailDebounced=n.debounce(this.onNewEmail.bind(this,e._sourceElement),6e3,!0),l.subscribe(t,this.onMessage.bind(this))},onMessage:function(e){!0===n.result(e,"hasNewEmail")&&this.onNewEmailDebounced()},onNewEmail:function(e){!1===e.parent().hasClass("show")&&e.show().delay(5e3).fadeOut(1e3)}})}.call(t,i,t,e),void 0===o||(e.exports=o)},"./bundles/oroemail/js/app/components/sidebar-recent-emails-component.js":(e,t,i)=>{var o;o=function(e,t,o){"use strict";const n=i("./bundles/oroui/js/extend/underscore.js"),s=i("./bundles/oroui/js/app/components/base/component.js"),l=i("./bundles/oroui/js/app/services/module-config.js").A(o.id),a=i("./bundles/oroui/js/mediator.js"),r=i("./bundles/orosync/js/sync.js"),c=l.wsChannel,u=i("./bundles/oroemail/js/util/unread-email-count-cache.js"),d=i("./bundles/oroemail/js/app/models/email-notification/email-notification-collection.js"),m=i("./bundles/oroemail/js/app/models/email-notification/email-notification-count-model.js"),p=s.extend({notificationHandler:null,listen:{"change:settings model":"onSettingsChange"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){const t=this.model.get("settings"),i=u.get(t.folderId);this.model.emailNotificationCountModel=new m({unreadEmailsCount:i}),this.listenTo(this.model.emailNotificationCountModel,"change:unreadEmailsCount",this.updateSidebarCount),this.updateSidebarCount(),this.model.emailNotificationCollection=new d([],{routeParameters:n.pick(t,["limit","folderId"])}),this.listenTo(this.model.emailNotificationCollection,"request",this.onFetchCollection),this.listenTo(this.model.emailNotificationCollection,"sync",this.updateModelFromCollection),this.model.emailNotificationCollection.fetch(),this.notificationHandler=n.debounce(this._notificationHandler.bind(this),1e3),r.subscribe(c,this.notificationHandler)},updateSidebarCount:function(){const e=Number(this.model.emailNotificationCountModel.get("unreadEmailsCount"));this.model.set({itemsCounter:e,highlighted:Boolean(e)})},onFetchCollection:function(){u.hasInitState()||this.model.trigger("start-loading")},updateModelFromCollection:function(e){const t=Number(n.result(this.model.get("settings"),"folderId")||0);u.set(t,e.unreadEmailsCount),this.model.trigger("end-loading"),this.model.emailNotificationCountModel.set("unreadEmailsCount",e.unreadEmailsCount)},onSettingsChange:function(e,t){n.delay((function(){e.emailNotificationCollection.setRouteParams(t)}),0)},_notificationHandler:function(){u.clear(),this.model.emailNotificationCollection.fetch(),a.trigger("datagrid:doRefresh:user-email-grid")},dispose:function(){this.disposed||(r.unsubscribe(c,this.notificationHandler),this.model.emailNotificationCollection.dispose(),delete this.model,p.__super__.dispose.call(this))}});return p}.call(t,i,t,e),void 0===o||(e.exports=o)},"./bundles/oroemail/js/app/components/user-menu-email-notification-component.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/underscore.js"),o=i("./bundles/orosync/js/sync.js"),n=i("./bundles/oroui/js/mediator.js"),s=i("./bundles/oroemail/js/app/models/email-notification/email-notification-collection.js"),l=i("./bundles/oroemail/js/app/models/email-notification/email-notification-count-model.js"),a=i("./bundles/oroemail/js/app/components/email-notification-component.js").extend({collection:null,countModel:null,notificationHandler:null,wsChannel:"",dropdownContainer:null,listen:{"sync collection":"updateCountModel","widget_dialog:open mediator":"onWidgetDialogOpen"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){let i=e.emails||[];t.extend(this,t.pick(e,["wsChannel"])),"string"==typeof i&&(i=JSON.parse(i)),this.collection=new s(i),this.countModel=new l({unreadEmailsCount:e.count}),this.dropdownContainer=e._sourceElement,this.notificationHandler=t.debounce(this._notificationHandler.bind(this),1e3),o.subscribe(this.wsChannel,this.notificationHandler),a.__super__.initialize.call(this,e)},_notificationHandler:function(){this.collection.fetch(),n.trigger("datagrid:doRefresh:user-email-grid")},updateCountModel:function(e){this.countModel.set("unreadEmailsCount",e.unreadEmailsCount)},onWidgetDialogOpen:function(){this.dropdownContainer.trigger("tohide.bs.dropdown")},dispose:function(){o.unsubscribe(this.wsChannel,this.notificationHandler),a.__super__.dispose.call(this)}});return a}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/models/check-smtp-connection-model.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";return i("./bundles/oroui/js/app/models/base/model.js").extend({defaults:{host:"",port:null,encryption:null,username:"",password:""},constructor:function e(...t){e.__super__.constructor.apply(this,t)}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/models/email-attachment-collection.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroemail/js/app/models/email-attachment-model.js");return i("./bundles/oroui/js/app/models/base/collection.js").extend({model:t,constructor:function e(...t){e.__super__.constructor.apply(this,t)}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/models/email-attachment-model.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";return i("./bundles/oroui/js/app/models/base/model.js").extend({defaults:{id:null,type:"",title:"",fileName:"",fileSize:"",modified:"",preview:"",icon:"",checked:!1,visible:!0,errors:[]},constructor:function e(...t){e.__super__.constructor.apply(this,t)},toggleChecked:function(){this.set("checked",!this.get("checked"))}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/models/email-editor-model.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";return i("./bundles/oroui/js/app/models/base/model.js").extend({defaults:{appendSignature:!1,isSignatureEditable:!1,signature:void 0,email:null,bodyFooter:void 0},constructor:function e(...t){e.__super__.constructor.apply(this,t)}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/models/email-model.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";return i("./bundles/oroui/js/app/models/base/model.js").extend({defaults:{parentEmailId:void 0,entityId:void 0,cc:void 0,bcc:void 0},constructor:function e(...t){e.__super__.constructor.apply(this,t)}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/models/email-notification/email-notification-collection.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroemail/js/app/models/email-notification/email-notification-model.js"),o=i("./bundles/oroui/js/app/models/base/routing-collection.js"),n=i("./bundles/oroui/js/error.js"),s=o.extend({model:t,routeDefaults:{routeName:"oro_email_last",routeQueryParameterNames:["limit","folderId"],limit:10,folderId:0},constructor:function e(...t){e.__super__.constructor.apply(this,t)},setRouteParams:function(e){this._route.set({limit:e.limit,folderId:e.folderId})},markAllAsRead:function(){for(const e in this.models)this.models.hasOwnProperty(e)&&this.models[e].set({seen:1});this.unreadEmailsCount=0},parse:function(e,t){if(this.checkServerResponse(e,t),!this.disposed)return this.unreadEmailsCount=e.count,e={data:e.emails},s.__super__.parse.call(this,e,t)},checkServerResponse:function(e){const t=e.emails.length,i=Number(e.count),o=this._route.get("limit");if(t>o||t<Math.min(o,i))throw new Error("Wrong server response",e);e.emails.forEach((function(t,o){(t.seen&&o<i||!t.seen&&o>=i)&&n.showErrorInConsole(e)}))}});return s}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/models/email-notification/email-notification-count-model.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";return i("./bundles/oroui/js/app/models/base/model.js").extend({defaults:{unreadEmailsCount:0},constructor:function e(...t){e.__super__.constructor.apply(this,t)}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/models/email-notification/email-notification-model.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";return i("./bundles/oroui/js/app/models/base/model.js").extend({replyRoute:"",replyAllRoute:"",forwardRoute:"",id:"",seen:"",subject:"",bodyContent:"",fromName:"",linkFromName:"",constructor:function e(...t){e.__super__.constructor.apply(this,t)}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/models/email-template-collection.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/fosjsrouting/js/router.js"),o=i("./bundles/oroemail/js/app/models/email-template-model.js"),n=i("./bundles/oroui/js/app/models/base/collection.js"),s=i("./bundles/oroui/js/extend/underscore.js"),l=n.extend({route:null,routeId:null,includeNonEntity:!1,includeSystemTemplates:!0,url:null,model:o,constructor:function e(...t){e.__super__.constructor.apply(this,t)},initialize:function(e,i){s.extend(this,s.pick(i,["route","routeId","includeNonEntity","includeSystemTemplates"]));const o={};o[this.routeId]=null,this.url=t.generate(this.route,o),l.__super__.initialize.call(this,e,i)},setEntityId:function(e){const i={};i[this.routeId]=e,i.includeNonEntity=this.includeNonEntity?"1":"0",i.includeSystemTemplates=this.includeSystemTemplates?"1":"0",this.url=t.generate(this.route,i)}});return l}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/models/email-template-model.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";return i("./bundles/oroui/js/app/models/base/model.js").extend({defaults:{entity:"",id:"",name:""},constructor:function e(...t){e.__super__.constructor.apply(this,t)}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/models/unread-emails-state-model.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";return i("./bundles/oroui/js/app/models/base/model.js").extend({defaults:{count:0,ids:[]},constructor:function e(t,i){e.__super__.constructor.call(this,t,i)}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/unread-emails-state-holder.js":(e,t,i)=>{var o;o=function(e,t,o){"use strict";const n=i("./bundles/oroui/js/extend/underscore.js"),s=i("./bundles/oroemail/js/app/models/unread-emails-state-model.js"),l=i("./bundles/orosync/js/sync.js"),a=i("./bundles/oroemail/js/app/models/email-notification/email-notification-collection.js"),r=i("./bundles/oroui/js/app/services/module-config.js").A(o.id).wsChannel;let c;function u(){this.unreadEmailsStateModel=new s,this.emailNotificationCollection=new a,l.subscribe(r,n.debounce(this._notificationHandler.bind(this),1e3))}return n.extend(u.prototype,{getModel:function(){return this.unreadEmailsStateModel},_notificationHandler:function(){this.emailNotificationCollection.fetch({success:this._onFetchSuccess.bind(this)})},_onFetchSuccess:function(e){const t=n.pluck(n.where(e.toJSON(),{seen:!1}),"id");this.unreadEmailsStateModel.set("count",e.unreadEmailsCount),this.unreadEmailsStateModel.set("ids",t)}}),{getModel:function(){return void 0===c&&(c=new u),c.getModel()}}}.call(t,i,t,e),void 0===o||(e.exports=o)},"./bundles/oroemail/js/app/views/check-saved-smtp-connection-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/orotranslation/js/translator.js"),n=i("./bundles/fosjsrouting/js/router.js"),s=i("./bundles/oroui/js/mediator.js"),l=i("./bundles/oroui/js/messenger.js");return i("./bundles/oroui/js/app/views/base/view.js").extend({route:"oro_email_check_saved_smtp_connection",events:{"click [data-role=check-saved-smtp-connection]":"checkSmtpConnection"},constructor:function e(t){e.__super__.constructor.call(this,t)},checkSmtpConnection:function(e){const i=this.$el.find(".check-smtp-connection-messages"),o=this.$el.closest("form");return s.execute("showLoading"),t.ajax({type:"GET",url:n.generate(this.route,{scopeClass:o.data("scope-class"),scopeId:o.data("scope-id")}),success:e=>{e?this.showMessage("error","oro.email.smtp_connection.error",i):this.showMessage("success","oro.email.smtp_connection.success",i)},errorHandlerMessage:!1,error:()=>{this.showMessage("error","oro.email.smtp_connection.error",i)},complete:()=>{s.execute("hideLoading")}}),!1},showMessage:function(e,t,i){l.notificationFlashMessage(e,o(t),{container:i,delay:5e3})}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/check-smtp-connection-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/orotranslation/js/translator.js"),s=i("./bundles/fosjsrouting/js/router.js"),l=i("./bundles/oroui/js/mediator.js"),a=i("./bundles/oroui/js/messenger.js");return i("./bundles/oroui/js/app/views/base/view.js").extend({route:"oro_email_check_smtp_connection",entity:"user",entityId:0,organization:"",requestPrefix:"oro_email_configuration",events:{"click [data-role=check-smtp-connection]":"checkSmtpConnection"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){o.extend(this,o.pick(e,["entity","entityId","organization"]))},checkSmtpConnection:function(e){const i=this.$el.find('[data-class="smtp_settings"]').serializeArray(),o=this.$el.find(".check-smtp-connection-messages");return l.execute("showLoading"),this.clear(),t.ajax({type:"POST",url:this.getUrl(),data:this.prepareData(i),success:e=>{e?this.showMessage("error","oro.email.smtp_connection.error",o):this.showMessage("success","oro.email.smtp_connection.success",o)},errorHandlerMessage:!1,error:()=>{this.showMessage("error","oro.email.smtp_connection.error",o)},complete:()=>{l.execute("hideLoading")}}),!1},showMessage:function(e,t,i){a.notificationFlashMessage(e,n(t),{container:i,delay:5e3})},prepareData:function(e){const t={};return o.each(e,(e=>{const i=/^([^\[]+\[.+_)([^\]]+)(\].*)/i;i.test(e.name)&&(e.name=e.name.match(i)[2],t[e.name]=e.value)})),t},getUrl:function(){return s.generate(this.route)},clear:function(){this.model.set({host:"",port:null,encryption:null,username:"",password:""})}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-attachment-collection-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroemail/js/app/views/email-attachment-view.js"),n=i("./bundles/oroui/js/app/views/base/collection-view.js");return n.extend({itemView:o,listen:{"add collection":"collectionAdd","remove collection":"collectionRemove",visibilityChange:"onVisibilityChange"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize(e){n.__super__.initialize.call(this,e),this.itemView=this.itemView.extend({inputName:e.inputName,fileIcons:e.fileIcons,collectionView:this}),this.listSelector=e.listSelector,t(this.listSelector).html(""),this.$el.hide(),this.showHideAttachmentRow()},collectionAdd(e){if(e.get("id")||e.get("fileName"))this.showHideAttachmentRow();else{const t=this.getItemView(e);void 0!==t&&t.fileSelect()}},collectionRemove(){const e=this;this.collection.each((function(t){!t||t.get("type")||t.get("id")||e.collection.remove(t)})),this.showHideAttachmentRow()},showHideAttachmentRow(){this.collection.isEmpty()?this.hide():this.show()},show(){this.$el.show()},hide(){this.$el.hide()},onVisibilityChange(){this.$el.trigger("content:changed")}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-attachment-link-view.js":(e,t,i)=>{var o,n;o=[i("./bundles/oroui/js/extend/jquery.js"),i("./bundles/oroui/js/extend/underscore.js"),i("./bundles/orotranslation/js/translator.js"),i("./bundles/oroui/js/extend/backbone.js"),i("./bundles/oroui/js/messenger.js"),i("./bundles/oroui/js/app/views/base/view.js"),i("./bundles/oroui/js/mediator.js")],void 0===(n=function(e,t,i,o,n,s,l){"use strict";const a=s.extend({options:{},events:{click:"linkAttachment"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){this.options=t.defaults(e||{},this.options),a.__super__.initialize.call(this,e)},linkAttachment:function(o){const s=this;return o.preventDefault(),e.post(this.options.url,{},(function(e){t.isUndefined(e.error)?(n.notificationFlashMessage("success",i("oro.email.attachment.added")),s.$el.parent().addClass("one"),s.$el.remove(),s.reloadAttachmentGrid()):n.notificationFlashMessage("error",i(e.error))}),"json"),!1},reloadAttachmentGrid:function(){l.trigger("datagrid:doRefresh:attachment-grid")}});return a}.apply(t,o))||(e.exports=n)},"./bundles/oroemail/js/app/views/email-attachment-list-row-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/orolocale/js/formatter/datetime.js"),n=i("./bundles/orolocale/js/numeral-l10n.js"),s=i("./bundles/oroemail/js/app/models/email-attachment-model.js"),l=i("./bundles/oroui/js/app/views/base/view.js"),a=i("../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oroemail/templates/email-attachment/email-attachment-list-row-view.html"),r=l.extend({model:s,events:{'click input[type="checkbox"]':"checkboxClick"},listen:{"change:visible model":"visibilityChange"},constructor:function e(t){e.__super__.constructor.call(this,t)},render:function(){r.__super__.render.call(this),this.$el.attr("data-type",this.model.get("type")),this.$el.find('[data-toggle="popover"]').popover({html:!0,delay:{show:300,hide:100}})},getTemplateFunction:function(){return this.template||(this.template=a),r.__super__.getTemplateFunction.call(this)},getTemplateData:function(){const e=r.__super__.getTemplateData.call(this);return"fileName"in e&&e.fileName.length>15&&(e.fileName=e.fileName.substr(0,7)+".."+e.fileName.substr(e.fileName.length-7)),"fileSize"in e&&(e.fileSize=n(e.fileSize).format("0.00b")),"modified"in e&&(e.modified=o.formatDateTime(e.modified.date)),e},checkboxClick:function(e){this.model.set("checked",t(e.target).prop("checked"))},visibilityChange:function(){this.render()}});return r}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-attachment-select-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/underscore.js"),o=i("./bundles/oroui/js/extend/jquery.js"),n=i("./bundles/oroemail/js/app/views/email-attachment-list-row-view.js"),s=i("./bundles/oroui/js/app/views/base/collection-view.js"),l=i("../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oroemail/templates/email-attachment/email-attachment-select-view.html"),a=s.extend({itemView:n,listSelector:".attachment-list",fallbackSelector:".no-items",isShowed:!1,fileNameFilter:"",attachedCollection:null,events:{"click .cancel":"cancelClick","click .upload-new":"uploadNewClick","click .attach":"attachClick","input input.filter":"filterChange"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){if(!t.has(e,"attachedCollection"))throw new Error('Required option "attachedCollection" not found.');a.__super__.initialize.call(this,e),this.attachedCollection=e.attachedCollection},resolveListSelector:function(e){return 1===e.get("type")?".entity-attachments-list":".thread-attachments-list"},insertView:function(e,t,i){this.list=this.resolveListSelector(e),this.$list=o(this.list),i=this.$list.get(0).children.length,a.__super__.insertView.call(this,e,t,i)},showHideGroups:function(){const e=this.$(".entity-attachments"),t=this.$(".thread-attachments");this.collection.where({type:1,visible:!0}).length>0?e.show():e.hide(),this.collection.where({type:2,visible:!0}).length>0?t.show():t.hide()},showHideFilter:function(){const e=this.$(".filter-block");this.collection.length>5?e.show():e.hide()},cancelClick:function(){this.hide()},attachClick:function(){this.collection.trigger("attach")},uploadNewClick:function(){this.$("input.input-upload-new").click()},filterChange:function(e){const t=o(e.target).val();this.collection.each((function(e){0===e.get("fileName").indexOf(t)?e.set("visible",!0):e.set("visible",!1)})),this.showHideGroups()},getTemplateFunction:function(){return this.template||(this.template=l),a.__super__.getTemplateFunction.call(this)},show:function(){this.resetCheckedModels(),this.$el.show(),this.isShowed=!0},hide:function(){this.$el.hide(),this.isShowed=!1},resetCheckedModels:function(){this.collection.each((function(e){const t=Boolean(this.attachedCollection.get(e.get("id")));e.get("checked")!==t&&(e.set("checked",t),this.renderItem(e))}),this)}});return a}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-attachment-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroemail/js/app/models/email-attachment-model.js"),o=i("./bundles/oroui/js/app/views/base/view.js").extend({model:t,inputName:"",events:{'click [data-role="remove"]':"removeClick"},listen:{"change:fileName model":"fileNameChange","change:type model":"typeChange","change:icon model":"iconChange"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize(e){this.guessFileIcon()},getTemplateFunction(){return this.template||(this.template=i("../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oroemail/templates/email-attachment/email-attachment-item.html")),o.__super__.getTemplateFunction.call(this)},getTemplateData(){const e=o.__super__.getTemplateData.call(this);return e.cid=this.model.cid,e.inputName=this.inputName,e},removeClick(){this.model.trigger("destroy",this.model)},fileSelect(){const e=this.$('input[type="file"]');this.$el.hide(),e.on("change",(()=>{const t=e.val().replace(/^.*[\\\/]/,"");t&&(this.model.set("fileName",t),this.model.set("type",3),this.guessFileIcon(),this.$el.show(),this.collectionView.show(),this.$el.trigger("content:changed"))})),e.click()},guessFileIcon(){const e=this.model.get("fileName");if(e){const t=e.substr(e.lastIndexOf(".")+1);let i=this.fileIcons.default;t&&this.fileIcons[t]&&(i=this.fileIcons[t]),this.model.set("icon",i)}},fileNameChange(){this.$(".attachment-item__filename").html(this.model.get("fileName")).attr("title",this.model.get("fileName"))},typeChange(){this.$("input.attachment-type").val(this.model.get("type"))},iconChange(){this.$(".attachment-item .fa").addClass(this.model.get("icon"))}});return o}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-body-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/oroui/js/app/views/base/view.js"),s=i("./bundles/oroui/js/error.js"),l=n.extend({autoRender:!0,bodyContent:null,styles:null,events:{"click .email-extra-body-toggle":"onEmailExtraBodyToggle"},listen:{"layout:reposition mediator":"_updateHeight"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){o.extend(this,o.pick(e,["bodyContent","styles"])),this.$frame=this.$el,this.$frame.on("emailShown",this._updateHeight.bind(this)),this.$frame.on("load",this.reattachBody.bind(this)),this.setElement(this.$el.contents().find("html")),l.__super__.initialize.call(this,e)},dispose:function(){this.disposed||(this.$frame&&this.$frame.off(),delete this.$frame,l.__super__.dispose.call(this))},render:function(){let e,i=this.bodyContent;try{e=t("<div>"+i+"</div>")}catch(o){s.showErrorInConsole(o),i=i.replace(/[&<>]/g,(function(e){return"&#"+e.charCodeAt(0)+";"})),e=t('<div class="plain-text">'+i+"</div>")}return this.$("body").html(e),this._injectStyles(),this._markEmailExtraBody(),this._updateHeight(),this},reattachBody:function(){this.undelegateEvents(),this.$frame.contents().find("html").replaceWith(this.$el),this.delegateEvents()},_injectStyles:function(){if(!this.styles)return;const e=this.$("head");o.each(this.styles,(function(i){t("<link/>",{rel:"stylesheet",href:i}).appendTo(e)}))},_updateHeight:function(){const e=this.$frame,t=this.$el;o.delay((function(){e.height(0),e.height(t[0].scrollHeight)}),50)},_markEmailExtraBody:function(){const e=this.$("body>.quote, body>.gmail_extra").not(".email-extra-body").addClass("email-extra-body");t('<div class="email-extra-body-toggle"></div>').insertBefore(e)},onEmailExtraBodyToggle:function(e){this.$(e.currentTarget).next().toggleClass("in"),this._updateHeight()}});return l}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-editor-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/app/views/base/view.js"),o=i("./bundles/oroui/js/extend/jquery.js"),n=i("./bundles/fosjsrouting/js/router.js"),s=i("./bundles/oroui/js/extend/underscore.js"),l=i("./bundles/orotranslation/js/translator.js"),a=i("./bundles/oroui/js/mediator.js"),r=i("./bundles/oroemail/js/app/apply-template-confirmation.js"),c=t.extend({templatesProvider:null,editorComponentName:null,readyPromise:null,domCache:null,events:{"click #add-signature":"onAddSignatureButtonClick",'change [name$="[template]"]':"onTemplateChange",'change [name$="[type]"]':"onTypeChange"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){c.__super__.initialize.call(this,e),this.templatesProvider=e.templatesProvider,this.editorComponentName=e.editorComponentName,this.setupCache()},render:function(){return this.domCache.body.val(this.initBody(this.domCache.body.val())),this.addForgedAsterisk(),this.renderPromise=this.initLayout(),this.renderPromise.done(this.initFields.bind(this)),this},setupCache:function(){this.domCache={subject:this.$('[name$="[subject]"]'),body:this.$('[name$="[body]"]'),type:this.$('[name$="[type]"]'),template:this.$('[name$="[template]"]')}},onAddSignatureButtonClick:function(){let e,t;const i=this.model.get("signature");i?this.getBodyEditorView().tinymceInstance?this.addHTMLSignature(i):this.addTextSignature(i):(e=n.generate("oro_user_profile_configuration",{activeGroup:"platform",activeSubGroup:"user_email_configuration"}),t=this.model.get("isSignatureEditable")?l("oro.email.thread.no_signature",{url:e}):l("oro.email.thread.no_signature_no_permission"),a.execute("showFlashMessage","info",t))},addHTMLSignature:function(e){const t=this.getBodyEditorView().tinymceInstance,i=t.getBody().querySelector(".quote"),o=t.dom.create("p",{},e);t.getBody().insertBefore(o,i),t.selection.setCursorLocation(o),o.scrollIntoView(),t.execCommand("mceFocus",!1)},addTextSignature:function(e){let t,i,o=this.domCache.body.val();const n=this.getBodyEditorView().getFirstQuoteLine();e=e.replace(/(<([^>]+)>)/gi,""),n&&(t=o.indexOf(n),-1!==t&&(o=o.substr(0,t)+e+"\r\n"+o.substr(t),i=t+e.length)),s.isUndefined(i)&&(o+="\r\n"+e,i=o.length),this.domCache.body.val(o).setCursorPosition(i).focus()},onTemplateChange:function(e){const t=o(e.target).val();if(!t)return;const i=new r({content:l("oro.email.emailtemplate.apply_template_confirmation_content")});i.on("ok",(()=>{a.execute("showLoading"),this.templatesProvider.create(t,this.model.get("email").get("relatedEntityId")).always(a.execute.bind(a,"hideLoading")).fail(this.showTemplateErrorMessage.bind(this)).done(this.fillForm.bind(this))})),i.open()},showTemplateErrorMessage:function(e){const t=e&&e.responseJSON?e.responseJSON.reason:"",i=this._getErrorContainer();i.find(".alert-error").remove(),a.execute("showMessage","error",t||l("oro.email.emailtemplate.load_failed"),{container:i})},fillForm:function(e){const t=this.getBodyEditorView();this._getErrorContainer().find(".alert-error").remove(),this.model.get("parentEmailId")&&this.domCache.subject.val()||this.domCache.subject.val(e.subject);const i=this.initBody(e.body,!1);this.domCache.body.val(i),t.enabled&&t.tinymceInstance&&t.tinymceInstance.setContent(i),this.domCache.type.find("input[value="+e.type+"]").prop("checked",!0).trigger("change")},onTypeChange:function(e){this.getBodyEditorView().setIsHtml("html"===o(e.target).val())},getBodyEditorView:function(){return this.pageComponent("wrap_"+this.editorComponentName).view.pageComponent(this.editorComponentName).view},initFields:function(){this.model.get("email").get("bcc").length&&this.model.get("email").get("cc").length||this.$('[data-ftid$="_email_to"]').parents(".controls").find("ul.select2-choices").after('<div class="cc-bcc-holder"/>'),this.model.get("email").get("cc").length||this.hideField("Cc",l("oro.email.cc.label")),this.model.get("email").get("bcc").length||this.hideField("Bcc",l("oro.email.bcc.label"))},showField:function(e,t){const i=e.toLowerCase(),o=this.$('[data-ftid$="_email_'+i+'"]');o.parents(".control-group.taggable-field").show(),o.parents(".controls").find("input.select2-input").unbind("focusout").on("focusout",(i=>{setTimeout((()=>{o.val()||this.hideField(e,t)}),200)})).focus(),this.$('[data-ftid$="_email_to"]').parents(".control-group.taggable-field").find("label").html(l("oro.email.to.label")),this.addForgedAsterisk()},hideField:function(e,t){const i=e.toLowerCase();this.$('[data-ftid$="_email_'+i+'"]').parents(".control-group.taggable-field").hide(),this.$("span.show"+e).length>0||(this.$(".cc-bcc-holder").append('<span class="show'+e+'">'+t+"</span>"),this.$(".show"+e).on("click",(i=>{i.stopPropagation();const n=i.target;o(n).remove(),this.showField(e,t)})))},addForgedAsterisk:function(){const e=this.$(".forged-required").find("label"),t=e.find("em");t.length<=0?e.append("<em>*</em>"):t.html("*")},initBody:function(e,t){t=void 0===t||t;const i=this.model.get("signature");return this.model.get("appendSignature")&&t&&i&&e.indexOf(i)<0&&(e+="<br/><br/>"+this.model.get("signature")),this.model.get("bodyFooter")&&(e="<body>"+e,e+=this.model.get("bodyFooter")+"</body>"),e},_getErrorContainer:function(){return this.$('[name$="[template]"]').parent()}});return c}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-field-condition-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/orotranslation/js/translator.js"),s=i("./bundles/oroquerydesigner/js/app/views/field-condition-view.js"),l=i("./bundles/oroentity/js/app/views/customset-field-choice-view.js"),a=s.extend({entityData:null,constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){this.entityData=e.entityData,a.__super__.initialize.call(this,e)},getApplicableConditions:function(){return{type:"string"}},initChoiceInputView:function(){const e=this.entityData.fields.map((function(e){return{id:e.name,text:e.label}})),i=[{text:n("oro.entity.field_choice.fields"),children:e}],s=new l({autoRender:!0,el:this.$choiceInput,select2:o.extend({},this.options.fieldChoice.select2,{data:i,formatSelectionTemplate:this.choiceSelectionTemplate,formatBreadcrumbItem:function(e){return e.label},breadcrumbs:function(){return[o.pick(this.entityData,"label")]}.bind(this)})});return t.when(s)}});return a}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-folder-tree-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/oroui/js/mediator.js"),s=i("./bundles/oroui/js/app/views/base/view.js").extend({dataInputSelector:null,checkAllSelector:null,relatedCheckboxesSelector:null,requiredOptions:["dataInputSelector","checkAllSelector","relatedCheckboxesSelector"],constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){o.each(this.requiredOptions,(function(t){if(!o.has(e,t))throw new Error('Required option "'+t+'" not found.')})),this.dataInputSelector=e.dataInputSelector,this.$el.closest("form").on("submit"+this.eventNamespace(),this._onSubmit.bind(this)),this.checkAllSelector=e.checkAllSelector,this.relatedCheckboxesSelector=e.relatedCheckboxesSelector,this.$(this.checkAllSelector).on("change"+this.eventNamespace(),this._onCheckAllChange.bind(this)),this.listenTo(n,"serializeFolderCollection",this._serializeFolderCollection)},dispose:function(){this.disposed||(this.$el.closest("form").off(this.eventNamespace()),this.$(this.checkAllSelector).off(this.eventNamespace()),s.__super__.dispose.call(this))},_inputData:function(e){const i={};return e.find("> input[data-name]").add(e.find("> label > input[data-name]:checked")).each((function(){const e=t(this);i[e.attr("data-name")]=e.val()})),i.subFolders=this._inputCollectionData(e.find("> .folder-sub-folders").children()),i},_inputCollectionData:function(e){return o.map(e,(function(e){return this._inputData(t(e))}),this)},_serializeFolderCollection:function(){const e=this._inputCollectionData(this.$(".folder-list").children());this.$(this.dataInputSelector).val(JSON.stringify(e))},_onSubmit:function(){this._serializeFolderCollection()},_onCheckAllChange:function(e){this.$(this.relatedCheckboxesSelector).prop("checked",e.currentTarget.checked)}});return s}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-item-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";return i("./bundles/oroui/js/app/views/base/view.js").extend({events:{"click .email-view-toggle":"onEmailHeadClick"},listen:{commentCountChanged:"updateCommentsQuantity"},commentCount:0,constructor:function e(t){e.__super__.constructor.call(this,t)},render:function(){return this._deferredRender(),this.initLayout().done((()=>{const e=this.pageComponent("comments");e&&(this.commentCount=this.fetchCommentsQuantity(),this.listenTo(e.collection,"stateChange",this.onCommentsStateChange),this.updateCommentsQuantity()),this._resolveDeferredRender()})),this},refresh:function(){const e=this.pageComponent("email-body");e&&e.view.reattachBody()},onCommentsStateChange:function(){const e=this.fetchCommentsQuantity()-this.commentCount;0!==e&&(this.trigger("commentCountChanged",e),this.commentCount+=e)},onEmailHeadClick:function(e){const t="a, .dropdown",i=this.$(e.target);i.is(t)||i.parents(t).length||this.toggle()},toggle:function(e){this.$el.is(":last-child")||(this.$el.toggleClass("in",e),this.$el.hasClass("in")&&this.$el.find("iframe").triggerHandler("emailShown"),this.trigger("toggle",this))},updateCommentsQuantity:function(){const e=this.fetchCommentsQuantity();this.$(".comment-count").toggle(Boolean(e)),this.$(".comment-count .count").text(e)},fetchCommentsQuantity:function(){let e=null;const t=this.pageComponent("comments");return t&&(e=t.collection.getState().totalItemsQuantity),e}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-notification/email-notification-collection-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/orotranslation/js/translator.js"),s=i("./bundles/oroui/js/mediator.js"),l=i("./bundles/fosjsrouting/js/router.js"),a=i("./bundles/oroemail/js/util/emails-grid-route-builder.js"),r=i("./bundles/oroemail/js/app/views/email-notification/email-notification-item-view.js"),c=i("./bundles/oroui/js/app/views/base/collection-view.js"),u=i("./bundles/oroui/js/app/views/loading-mask-view.js"),d=c.extend({template:i("../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oroemail/templates/email-notification/email-notification-collection-view.html"),itemView:r,animationDuration:0,listSelector:".items",countNewEmail:0,folderId:0,hasMarkAllButton:!0,hasMarkVisibleButton:!1,loadingMask:null,defaultActionId:1,listen:{"change:seen collection":"onSeenStatusChange","reset collection":"onResetCollection","request collection":"onCollectionRequest","sync collection":"onCollectionSync","layout:reposition mediator":"adjustMaxHeight"},events:{click:"onClickIconEnvelope","click button.mark-as-read":"onClickMarkAsRead","click button.mark-visible-as-read":"onClickMarkVisibleAsRead"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){d.__super__.initialize.call(this,e),o.extend(this,o.pick(e,["folderId","hasMarkAllButton","hasMarkVisibleButton"])),this.countNewEmail=parseInt(e.countNewEmail),e.defaultActionId&&(this.defaultActionId=parseInt(e.defaultActionId))},render:function(){d.__super__.render.call(this),this.updateViewMode(),o.defer(this.adjustMaxHeight.bind(this))},getTemplateData:function(){const e=d.__super__.getTemplateData.call(this),t=this.collection.filter((function(e){return!1===e.get("seen")})).length;return o.extend(e,o.pick(this,["defaultActionId","countNewEmail","folderId","hasMarkAllButton","hasMarkVisibleButton"])),e.userEmailsUrl=a.generate(this.folderId),e.moreUnreadEmails=Math.max(this.countNewEmail-t,0),e},updateViewMode:function(){if(!this.isActiveTypeDropDown("notification")){const e=this.$el.find(".dropdown-toggle .fa-envelope");0===this.collection.models.length?(this.setModeDropDownMenu("empty"),e.removeClass("highlight")):(this.setModeDropDownMenu("content"),this.countNewEmail>0?e.addClass("highlight"):e.removeClass("highlight"))}},adjustMaxHeight:function(){let e,t,i,o;this.el&&(i=parseInt(this.$el.css("max-height")),o=this.$list,1!==o.length||isNaN(i)||(e=this.$el[0].getBoundingClientRect(),t=o.parent()[0].getBoundingClientRect(),o.css("max-height",e.top+i+o.height()-t.bottom+"px")))},_markAsRead:function(e){t.ajax({method:"POST",url:l.generate("oro_email_mark_all_as_seen",e),success:e=>{this.collection.markAllAsRead(),this.collection.unreadEmailsCount=0,this.countNewEmail=0,this.render(),e.successful&&s.trigger("datagrid:doRefresh:user-email-grid")},errorHandlerMessage:n("oro.email.error.mark_as_read")})},onClickMarkVisibleAsRead:function(){const e=[];this.collection.each((function(t){!1===t.get("seen")&&e.push(t.get("id"))})),this._markAsRead({ids:e})},onClickMarkAsRead:function(){this._markAsRead({})},onSeenStatusChange:function(e,t){t&&this.countNewEmail>0?this.countNewEmail--:this.countNewEmail++},resetModeDropDownMenu:function(){return this.$el.find(".dropdown-menu").removeClass("content empty notification"),this},setModeDropDownMenu:function(e){this.resetModeDropDownMenu(),this.$el.find(".dropdown-menu").addClass(e)},isActiveTypeDropDown:function(e){return this.$el.find(".dropdown-menu").hasClass(e)},onResetCollection:function(){this.collection.unreadEmailsCount=0},onClickIconEnvelope:function(){this.isActiveTypeDropDown("notification")&&(this.open(),this.setModeDropDownMenu("content")),this.updateViewMode()},isOpen:function(){this.$el.hasClass("show")},close:function(){this.$el.removeClass("show")},open:function(){this.$el.addClass("show")},onCollectionRequest:function(){this.loadingMask&&(this.loadingMask.hide(),this.loadingMask.dispose()),this.loadingMask=new u({container:this.$(".content")}),this.loadingMask.show()},onCollectionSync:function(){this.loadingMask&&(this.loadingMask.hide(),this.loadingMask.dispose(),this.loadingMask=null),this.render()},dispose:function(){this.loadingMask&&(this.loadingMask.hide(),this.loadingMask.dispose(),this.loadingMask=null),d.__super__.dispose.call(this)}});return d}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-notification/email-notification-count-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/app/views/base/view.js").extend({autoRender:!0,listen:{"change:unreadEmailsCount model":"render"},template:i("../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oroemail/templates/email-notification/email-notification-icon-view.html"),constructor:function e(t){e.__super__.constructor.call(this,t)},getTemplateData:function(){const e=t.__super__.getTemplateData.call(this);return void 0===e.unreadEmailsCount&&(e.unreadEmailsCount=0),e}});return t}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-notification/email-notification-item-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/orotranslation/js/translator.js"),s=i("./bundles/oroui/js/extend/backbone.js"),l=i("./bundles/oroui/js/mediator.js"),a=i("./bundles/fosjsrouting/js/router.js"),r=i("./bundles/oroui/js/app/views/base/view.js").extend({tagName:"li",attributes:{"data-layout":"separate"},templateSelector:"#email-notification-item-template",events:{"click .title":"onClickOpenEmail","click [data-role=toggle-read-status]":"onClickReadStatus"},listen:{"change model":"render",addedToParent:"delegateEvents"},constructor:function e(t){e.__super__.constructor.call(this,t)},render:function(){r.__super__.render.call(this),this.$el.toggleClass("highlight",!this.model.get("seen")),this.initLayout()},getTemplateFunction:function(){return this.template||(this.template=t(this.templateSelector).html()),r.__super__.getTemplateFunction.call(this)},onClickOpenEmail:function(){const e=a.generate("oro_email_thread_view",{id:this.model.get("id")});this.model.set({seen:!0}),l.execute("redirectTo",{url:e})},onClickReadStatus:function(e){e.stopPropagation();const t=this.model,i=t.get("seen"),r=a.generate("oro_email_mark_seen",{id:t.get("id"),status:i?0:1,checkThread:0});t.set("seen",!i),s.ajax({type:"POST",url:r,success:function(e){!0!==o.result(e,"successful")&&(t.set("seen",i),l.execute("showErrorMessage",n("Sorry, an unexpected error has occurred."),"error"))},error:function(e,o,n){t.set("seen",i)}})}});return r}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-notification/mobile-email-notification-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroui/js/app/views/base/view.js").extend({autoRender:!0,countNewEmail:null,constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){o.__super__.initialize.call(this,e),this.countNewEmail=parseInt(e.countNewEmail)},render:function(){const e=t("#user-menu .oro-email-user-emails a");this.$counter=t('<span class="email-count"/>').appendTo(e),this.setCount(this.countNewEmail)},remove:function(){this.$counter.remove(),o.__super__.remove.call(this)},setCount:function(e){this.countNewEmail=e=parseInt(e),e=0===e?"":"("+(e>99?"99+":e)+")",this.$counter.html(e),t("#user-menu .dropdown-toggle").toggleClass("has-new-emails",Boolean(this.countNewEmail))}});return o}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-sync-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/app/views/base/view.js"),o=i("./bundles/oroui/js/extend/jquery.js"),n=i("./bundles/oroui/js/messenger.js");return t.extend({optionNames:t.prototype.optionNames.concat(["syncPath","processingMessage","errorHandlerMessage","actionProcessing","actionSync"]),events:{'click [data-role="sync"]':"onSync"},constructor:function e(t){e.__super__.constructor.call(this,t)},onSync:function(e){e.preventDefault();const t=o(e.currentTarget);t.attr("disabled")||o.ajax({type:"POST",dataType:"json",url:this.syncPath,errorHandlerMessage:this.errorHandlerMessage,beforeSend:function(){t.html(this.actionProcessing),t.attr("disabled","disabled")}.bind(this),success:function(e){void 0!==e.error?n.notificationFlashMessage("error",e.error):n.notificationFlashMessage("info",this.processingMessage)}.bind(this),complete:function(){t.html(this.actionSync),t.removeAttr("disabled")}.bind(this)})}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-template-editor-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/orotranslation/js/translator.js"),s=i("./bundles/oroui/js/app/views/base/view.js"),l=i("./bundles/orowindows/js/widget/dialog-widget.js"),a=s.extend({options:{typeSwitcher:'input[name*="type"]',hasWysiwyg:!1,isWysiwygEnabled:!1,emailVariableView:{}},listen:{"email-variable-view:click-variable mediator":"_onVariableClick"},events:{"change input[name*=type]":"_onTypeChange","click .dialog-form-renderer":"_onPreview"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){a.__super__.initialize.call(this,e),this.options=o.defaults(e||{},this.options),this.render()},render:function(){this.initLayout().then(this.afterLayoutInit.bind(this))},afterLayoutInit:function(){this.options.hasWysiwyg=Boolean(this.$('textarea[name*="content"]:first').data("wysiwygEnabled")),this.options.hasWysiwyg&&(this.options.isWysiwygEnabled="html"===this.$(this.options.typeSwitcher).filter(":checked").val(),this.options.emailVariableView=this.pageComponent("email-template-variables"),this._onEditorBlur(),!1===this.options.isWysiwygEnabled&&this._switchWysiwygEditor(!1))},_onPreview:function(e){e.preventDefault();const i=this.$el,o="preview-frame",s=t("<iframe />",{name:o,id:o,frameborder:0,marginwidth:20,marginheight:20,allowfullscreen:!0}),a=i.attr("action");i.one("submit",(function(r){if(!r.result)return;const c=new l({title:n("Preview"),dialogOptions:{modal:!0,resizable:!0,width:"85%",height:"70%",autoResize:!0}});c.render(),c._onContentLoad('<div class="widget-content"></div>'),c._showLoading(),c.widget.addClass("dialog-single-iframe-container"),c.$el.append(s),i.attr("target",o),i.attr("action",t(e.currentTarget).attr("href")),s.one("load",(function(){c._hideLoading(),i.removeAttr("target"),i.attr("action",a)})),r.stopImmediatePropagation()})),i.submit()},_onVariableClick:function(e,t){this.options.isWysiwygEnabled&&this.forEachComponent((function(i){!0===o.result(i.view,"tinymceConnected")&&i.view.$el.is(e)&&(i.view.tinymceInstance.execCommand("mceInsertContent",!1,t),i.view.tinymceInstance.execCommand("mceFocus",!1,t))}))},_onEditorBlur:function(){this.options.hasWysiwyg&&this.options.isWysiwygEnabled&&this.forEachComponent((function(e){if(!0===o.result(e.view,"tinymceConnected")&&!o.isNull(this.options.emailVariableView)){const i=e.view.tinymceInstance;if(!i)return;t(i.getBody()).off(`blur${e.view.eventNamespace()}`).on(`blur${e.view.eventNamespace()}`,(e=>{t(i.targetElm).trigger(e)}))}}))},_onTypeChange:function(e){if(this.options.hasWysiwyg){const i=t(e.target);if(!i.is(":checked"))return;"txt"===i.val()&&this._switchWysiwygEditor(!1),"html"===i.val()&&this._switchWysiwygEditor(!0)}},_switchWysiwygEditor:function(e){this.options.isWysiwygEnabled=e,this.forEachComponent((function(t){const i=t.view;o.isUndefined(i)||o.isUndefined(i.tinymceConnected)||(i.setIsHtml(e),this.listenToOnce(i,"TinyMCE:initialized",this._onEditorBlur.bind(this)))}))}});return a}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-template-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/oroui/js/app/views/base/view.js"),s=i("./bundles/oroemail/js/app/models/email-template-collection.js");return n.extend({optionNames:n.prototype.optionNames.concat(["collectionOptions","targetSelector","target"]),events:{change:"selectionChanged"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(){this.template=o.template(t("#emailtemplate-chooser-template").html()),this.collectionOptions&&this._initCollection(this.collectionOptions),this.targetSelector&&(this.target=t(this.targetSelector)),this.listenTo(this.collection,"reset",this.render),t(this.target).val()||this.selectionChanged()},_initCollection:function(e){this.collection=new s(null,e)},selectionChanged:function(){const e=this.$el.val();this.collection.setEntityId(e.split("\\").join("_")),e?this.collection.fetch({reset:!0}):this.collection.reset()},render:function(){t(this.target).val("").trigger("change"),t(this.target).find('option[value!=""]').remove(),this.collection.models.length>0&&t(this.target).append(this.template({entities:this.collection.models}))}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-thread-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/orotranslation/js/translator.js"),s=i("./bundles/oroui/js/mediator.js"),l=i("./bundles/fosjsrouting/js/router.js"),a=i("./bundles/oroui/js/tools.js"),r=i("./bundles/oroemail/js/app/views/email-item-view.js"),c=i("./bundles/oroui/js/app/views/base/view.js").extend({autoRender:!0,events:{"click .email-view-toggle-all":"onToggleAllClick",'click [data-role="email-load-more"]':"onLoadMoreClick","shown.bs.dropdown .email-detailed-info-table.dropdown":"onDetailedInfoOpen"},selectors:{emailItem:".email-info",loadMore:'[data-role="email-load-more"]',toggleAll:".email-view-toggle-all"},actionPanelSelector:null,constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){o.extend(this,o.pick(e,["actionPanelSelector"])),c.__super__.initialize.call(this,e),this.listenTo(s,"widget:doRefresh:email-thread",(function(){e.isBaseView&&s.trigger("widget:doRefresh:email-thread-context")}))},dispose:function(){this.$actionPanel&&(this.$actionPanel.find(this.selectors.toggleAll).remove(),delete this.$actionPanel),c.__super__.dispose.call(this)},render:function(){return this.actionPanelSelector&&(this.$actionPanel=t(this.actionPanelSelector),this.$actionPanel.empty().append('<a href="#" class="email-view-toggle-all"></a>').find(this.selectors.toggleAll).on("click",this.onToggleAllClick.bind(this)),this.updateToggleAllAction()),c.__super__.render.call(this),this._deferredRender(),this.initEmailItemViews(this.$(this.selectors.emailItem)).then(this._resolveDeferredRender.bind(this)),this},onToggleAllClick:function(e){this.loadEmails().done(this.toggleAllEmails.bind(this))},toggleAllEmails:function(){const e=this._hasHiddenEmails();o.each(this.subviews,(function(t){t.toggle(e)}))},onLoadMoreClick:function(e){this.$(this.selectors.loadMore).hasClass("process")||this.loadEmails()},onDetailedInfoOpen:function(e){const i=t(">.dropdown-menu",e.currentTarget),o=i[0],n=this.el.getBoundingClientRect();i.removeAttr("data-uid").removeClass("fixed-width").css({width:"",left:""});const s=Math.min(o.clientWidth,n.width);o.scrollWidth>s&&i.outerWidth(s).addClass("fixed-width");const l=o.getBoundingClientRect(),r=parseInt(i.css("left")),c="dropdown-menu-"+Date.now(),u=l.right-n.right;u>0&&(i.css({left:r-u+"px"}),i.attr("data-uid",c),a.addCSSRule("[data-uid="+c+"]:before, [data-uid="+c+"]:after","margin-left: "+u+"px"))},loadEmails:function(){let e,i;const o=this.$(this.selectors.loadMore).addClass("process").data("emailsItems");return o?(e=l.generate("oro_email_items_view",{ids:o.join(",")}),i=t.ajax(e).done(this.onDoneLoadEmails.bind(this)).fail(this.onFailLoadEmails.bind(this))):i=t.Deferred().resolve("").promise(),i},onDoneLoadEmails:function(e){if(this.disposed)return;const i=t(e);this.$(this.selectors.loadMore).replaceWith(i),this.initEmailItemViews(i.filter(this.selectors.emailItem))},onFailLoadEmails:function(){this.disposed||this.$(this.selectors.loadMore).removeClass("process")},initEmailItemViews:function(e){const i=o.map(e,this._initEmailItemView,this);return t.when.apply(this,i)},_initEmailItemView:function(e){const t=new r({autoRender:!0,el:e});return this.subview("email:"+t.cid,t),this.listenTo(t,{toggle:this.onEmailItemToggle,commentCountChanged:this.onCommentCountChange}),t.getDeferredRenderPromise()},refreshEmails:function(){o.each(this.subviews,(function(e){e.refresh()}))},onEmailItemToggle:function(){this.updateToggleAllAction(),this.$el.trigger("content:changed")},updateToggleAllAction:function(){const e=this.$(this.selectors.emailItem).length>1,t="oro.email.thread."+(this._hasHiddenEmails()?"expand_all":"collapse_all"),i=this.$actionPanel.find(this.selectors.toggleAll);i.toggle(e),i.text(n(t+".label")),i.attr("title",n(t+".tooltip"))},_hasHiddenEmails:function(){const e=Boolean(this.$(this.selectors.emailItem).not(".in").length),t=Boolean(this.$(this.selectors.loadMore).length);return e||t},onCommentCountChange:function(e){this.trigger("commentCountChanged",e)}});return c}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/email-translation-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js");return i("./bundles/oroui/js/app/views/base/view.js").extend({events:{'shown.bs.tab [data-role="change-localization"]':"onChangeLocalizationTab"},constructor:function e(t){e.__super__.constructor.call(this,t)},onChangeLocalizationTab:function(e){const i=t(e.target||window.event.target),o=i.attr("data-related");t(i.closest("form").find(":input.active-localization")).each((function(e,i){t(i).val(o)}))}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/mailbox-update-view.js":(e,t,i)=>{var o,n;o=[i("./bundles/oroui/js/extend/jquery.js"),i("./bundles/oroui/js/extend/backbone.js"),i("./bundles/oroui/js/extend/underscore.js"),i("./bundles/orotranslation/js/translator.js"),i("./bundles/oroui/js/mediator.js")],void 0===(n=function(e,t,i,o,n){"use strict";return t.View.extend({RELOAD_MARKER:"_reloadForm",events:{'change [name*="processType"]':"changeHandler"},constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(t){this.options=i.defaults(t||{},this.options);const o=e('input[name="oro_email_mailbox[passwordHolder]"]');e('input[name="oro_email_mailbox[origin][password]"]').val(o.val()),this.listenTo(n,"change:systemMailBox:email",this.onChangeEmail.bind(this))},changeHandler:function(t){n.trigger("serializeFolderCollection");const i=this.$el.serializeArray(),o=this.$el.attr("action"),s=this.$el.attr("method");i.push({name:this.RELOAD_MARKER,value:!0}),n.execute("submitPage",{url:o,type:s,data:e.param(i)})},onChangeEmail:function(e){const t=this.$el.find('input[name="oro_email_mailbox[email]"]');e&&e.email?(t.val(e.email),t.prop("readonly","readonly")):t.prop("readonly",!1)}})}.apply(t,o))||(e.exports=n)},"./bundles/oroemail/js/app/views/sidebar-widget/recent-emails/recent-emails-content-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/backbone.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/orosidebar/js/sidebar-constants.js"),s=i("./bundles/oroui/js/app/views/base/view.js"),l=i("./bundles/oroemail/js/app/components/email-notification-component.js");return s.extend({component:null,listen:{refresh:"onRefresh"},listenToUpdatePosition:!0,constructor:function e(t){e.__super__.constructor.call(this,t)},render:function(){this.model.notificationComponentInstance&&this.model.notificationComponentInstance.dispose();const e=this.model.get("settings"),t={_sourceElement:this.$el,collection:this.model.emailNotificationCollection,countModel:this.model.emailNotificationCountModel,defaultActionId:e.defaultActionId,folderId:e.folderId,hasMarkAllButton:!1,hasMarkVisibleButton:!0};return this.model.notificationComponentInstance=new l(t),this},onRefresh:function(){this.model.emailNotificationCollection.fetch()},onUpdatePosition:function(){const e=this.model.notificationComponentInstance.view;void 0!==this.model.collection.findWhere({state:n.WIDGET_MAXIMIZED_HOVER})&&e instanceof t.View&&!e.disposed&&o.isFunction(e.adjustMaxHeight)&&e.adjustMaxHeight()}})}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/sidebar-widget/recent-emails/recent-emails-setup-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/oroui/js/extend/underscore.js"),n=i("./bundles/orotranslation/js/translator.js"),s=i("./bundles/oroui/js/tools.js"),l=i("./bundles/fosjsrouting/js/router.js"),a=i("./bundles/oroui/js/app/views/loading-mask-view.js"),r=i("./bundles/orosidebar/js/app/views/base-widget/base-widget-setup-view.js");i("./bundles/oroui/js/extend/select2.js");const c=r.extend({template:i("../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oroemail/templates/sidebar-widget/recent-emails/recent-emails-setup-view.html"),foldersData:null,constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){c.__super__.initialize.call(this,e),t.getJSON(l.generate("oro_email_emailorigin_list"),(e=>{this.foldersData=this.parseFoldersData(e),this.foldersData.unshift({id:0,text:n("oro.email.recent_emails_widget.all_folders")}),this.render()}))},parseFoldersData:function(e){let t=[];return o.each(e,(function(e,i){let n;e.active&&(n=o.where(e.folder,{syncEnabled:!0}).map((function(e){return{id:Number(e.id),text:e.fullName}})),n.length>0&&(i?t.push({text:i,children:n}):t=t.concat(n)))})),t},getFolderInfo:function(e){const t={name:"",mailbox:""};return e=Number(e),null!==this.foldersData&&e&&o.each(this.foldersData,(function(i){let n;0===t.name.length&&("children"in i?(n=o.find(i.children,(function(t){return t.id===e})),void 0!==n&&(t.name=n.text,t.mailbox=i.text)):i.id===e&&(t.name=i.text))})),t},getTemplateData:function(){const e=this.model.toJSON();return e.foldersData=this.foldersData,e},widgetTitle:function(){return n("oro.email.recent_emails_widget.settings")},validation:{limit:{NotBlank:{},Regex:{pattern:"/^\\d+$/"},Number:{min:1,max:20}}},render:function(){c.__super__.render.call(this);const e=this.subview("loading");this.$el.find("[name=defaultActionId]").inputWidget("create","select2"),null!==this.foldersData?(e&&e.hide(),this.$el.find("[name=folderId]").inputWidget("create","select2",{initializeOptions:{data:this.foldersData}})):(e||this.subview("loading",new a({container:this.$(".recent-emails-setup")})),this.subview("loading").show())},fetchFromData:function(){const e=c.__super__.fetchFromData.call(this);return e.limit=Number(e.limit),e},onSubmit:function(){const e=this.fetchFromData(),t=this.getFolderInfo(e.folderId);e.folderName=t.name,e.mailboxName=t.mailbox,s.isEqualsLoosely(e,this.model.get("settings"))||this.model.set("settings",e),this.trigger("close")}});return c}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/app/views/unread-emails-counter-view.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/underscore.js"),o=i("./bundles/oroui/js/app/views/base/view.js"),n=i("./bundles/oroemail/js/app/unread-emails-state-holder.js"),s=o.extend({listen:{"change:count model":"render"},template:t.template('<%=(count < 100 ? count : "99+") %>'),constructor:function e(t){e.__super__.constructor.call(this,t)},initialize:function(e){this.model=n.getModel(),this.model.set("count",e.count),s.__super__.initialize.call(this,e)},render:function(){return s.__super__.render.call(this),this.$el.toggle(Number(this.model.get("count"))>0),this}});return s}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/datagrid/auto-response-rules-extension.js":(e,t,i)=>{var o,n;o=[i("./bundles/oroui/js/extend/jquery.js"),i("./bundles/oroui/js/mediator.js")],void 0===(n=function(e,t){"use strict";return{init:function(i,o){o.metadata.options.urlParams.mailbox?i.resolve():o.gridPromise.done((function(o){o.listenTo(t,"auto_response_rule:save",(function(t){const i=e('[name="oro_email_mailbox[unboundRules]"]'),n=i.val(),s=n?n.split(","):[];s.push(t),i.val(s.join(",")),o.collection.assignUrlParams({ids:s})})),i.resolve()})).fail((function(){i.reject()}))}}}.apply(t,o))||(e.exports=n)},"./bundles/oroemail/js/datagrid/listen-to-read-email-extension.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroemail/js/app/unread-emails-state-holder.js");return{init:function(e,i){i.gridPromise.done((i=>{t.getModel().on("change:ids",this._changeHandler.bind(this,i.collection)),e.resolve()})).fail((function(){e.reject()}))},_changeHandler:function(e,t,i){e.each((function(e){const t=-1===i.indexOf(Number(e.get("id")))?"email-row-is-read":"";e.set("row_class_name",t)}))}}}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/util/email-templates-provider.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";const t=i("./bundles/oroui/js/extend/jquery.js"),o=i("./bundles/fosjsrouting/js/router.js");return{create:function(e,i){const n=o.generate("oro_api_get_emailtemplate_compiled",{id:e,entityId:i});return t.ajax({url:n,dataType:"json",errorHandlerMessage:""}).then((function(e,t,i){return e}))}}}.call(t,i,t,e))||(e.exports=o)},"./bundles/oroemail/js/util/emails-grid-route-builder.js":(e,t,i)=>{var o,n;o=[i("./bundles/oroui/js/extend/jquery.js"),i("./bundles/fosjsrouting/js/router.js")],void 0===(n=function(e,t){"use strict";return{generate:function(i){let o=t.generate("oro_email_user_emails");if(Number(i)){const t=e.param({f:{folders:{value:[i]}}});o+="?"+e.param({grid:{"user-email-grid":"i=1"}})+encodeURIComponent("&"+t)}return o}}}.apply(t,o))||(e.exports=n)},"./bundles/oroemail/js/util/unread-email-count-cache.js":(e,t,i)=>{var o;o=function(e,t,o){"use strict";const n=i("./bundles/oroui/js/extend/underscore.js"),s=i("./bundles/oroui/js/app/services/module-config.js").A(o.id);let l=n.toArray(n.result(s,"unreadEmailsCount")),a=!0;return{hasInitState:function(){return a},set:function(e,t){const i=l.filter((function(t){return t.id!==e}));i.push({id:e,num:t}),l=i},get:function(e){let t;const i=n.find(l,(function(t){return Number(t.id)===Number(e)}));return t=void 0!==i?i.num:a?0:void 0,t},clear:function(){l=[],a=!1}}}.call(t,i,t,e),void 0===o||(e.exports=o)},"./bundles/oroemail/sidebar_widgets/recent_emails/js/widget.js":(e,t,i)=>{var o;void 0===(o=function(e){"use strict";return{Component:i("./bundles/oroemail/js/app/components/sidebar-recent-emails-component.js"),ContentView:i("./bundles/oroemail/js/app/views/sidebar-widget/recent-emails/recent-emails-content-view.js"),SetupView:i("./bundles/oroemail/js/app/views/sidebar-widget/recent-emails/recent-emails-setup-view.js"),titleTemplate:i("../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oroemail/templates/sidebar-widget/recent-emails/recent-emails-widget-title.html")}}.call(t,i,t,e))||(e.exports=o)}}]);