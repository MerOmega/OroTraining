(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[890],{"../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oropromotion/templates/field-errors.html":(module,__unused_webpack_exports,__webpack_require__)=>{var _=__webpack_require__("./bundles/oroui/js/extend/underscore.js");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="controls">\n    ',_.each(messages,(function(o){__p+='\n        <span class="validation-failed"><span><span>'+(null==(__t=o)?"":_.escape(__t))+"</span></span></span>\n    "})),__p+="\n</div>\n";return __p}},"./bundles/oropromotion/js/app/components/order-line-item-discounts-no-tax-component.js":(o,t,e)=>{var s;void 0===(s=function(o){"use strict";const t=e("./bundles/oroui/js/extend/underscore.js"),s=e("./bundles/oroui/js/mediator.js"),i=e("./bundles/oroui/js/app/components/base/component.js"),n=e("./bundles/oroui/js/app/views/loading-mask-view.js"),r=e("./bundles/orolocale/js/formatter/number.js");return i.extend({options:{selectors:{rowTotalAfterDiscount:".applied-discount-row-total-after-discount",appliedDiscountsAmount:".applied-discount-row-total-discount-amount"}},loadingMaskView:null,constructor:function o(t){o.__super__.constructor.call(this,t)},initialize:function(o){this.options=t.defaults(o||{},this.options),this.listenTo(s,{"entry-point:order:load:before":this.showLoadingMask,"entry-point:order:load":this.setDiscounts,"entry-point:order:load:after":this.hideLoadingMask}),this.loadingMaskView=new n({container:this.options._sourceElement})},showLoadingMask:function(){this.loadingMaskView.show()},hideLoadingMask:function(){this.loadingMaskView.hide()},setDiscounts:function(o){const e=this.options._sourceElement.closest("tr.order-line-item").index();if(!t.has(o.appliedDiscounts,e))return;const s=o.appliedDiscounts[e],i=r.formatCurrency(s.appliedDiscountsAmount,s.currency),n=r.formatCurrency(s.rowTotalAfterDiscount,s.currency);this.options._sourceElement.find(this.options.selectors.appliedDiscountsAmount).text(i),this.options._sourceElement.find(this.options.selectors.rowTotalAfterDiscount).text(n)}})}.call(t,e,t,o))||(o.exports=s)},"./bundles/oropromotion/js/app/components/order-line-item-discounts-tax-component.js":(o,t,e)=>{var s;void 0===(s=function(o){"use strict";const t=e("./bundles/oroui/js/extend/underscore.js"),s=e("./bundles/oroui/js/mediator.js"),i=e("./bundles/oroui/js/app/components/base/component.js"),n=e("./bundles/oroui/js/app/views/loading-mask-view.js"),r=e("./bundles/orolocale/js/formatter/number.js");return i.extend({options:{selectors:{rowTotalAfterDiscountIncludingTax:".applied-discount-row-total-after-discount-including-tax",rowTotalAfterDiscountExcludingTax:".applied-discount-row-total-after-discount-excluding-tax",appliedDiscountsAmount:".applied-discount-row-total-discount-amount"}},loadingMaskView:null,constructor:function o(t){o.__super__.constructor.call(this,t)},initialize:function(o){this.options=t.defaults(o||{},this.options),this.listenTo(s,{"entry-point:order:load:before":this.showLoadingMask,"entry-point:order:load":this.setDiscounts,"entry-point:order:load:after":this.hideLoadingMask}),this.loadingMaskView=new n({container:this.options._sourceElement})},showLoadingMask:function(){this.loadingMaskView.show()},hideLoadingMask:function(){this.loadingMaskView.hide()},setDiscounts:function(o){const e=this.options._sourceElement.closest("tr.order-line-item").index();if(!t.has(o.appliedDiscounts,e))return;const s=o.appliedDiscounts[e],i=r.formatCurrency(s.appliedDiscountsAmount,s.currency),n=r.formatCurrency(s.rowTotalAfterDiscountExcludingTax,s.currency),a=r.formatCurrency(s.rowTotalAfterDiscountIncludingTax,s.currency);this.options._sourceElement.find(this.options.selectors.appliedDiscountsAmount).text(i),this.options._sourceElement.find(this.options.selectors.rowTotalAfterDiscountExcludingTax).text(n),this.options._sourceElement.find(this.options.selectors.rowTotalAfterDiscountIncludingTax).text(a)}})}.call(t,e,t,o))||(o.exports=s)},"./bundles/oropromotion/js/app/views/applied-coupon-collection-view.js":(o,t,e)=>{var s;void 0===(s=function(o){"use strict";const t=e("./bundles/oroui/js/extend/jquery.js"),s=e("./bundles/fosjsrouting/js/router.js"),i=e("./bundles/oroui/js/extend/underscore.js"),n=e("./bundles/oroui/js/app/views/base/view.js"),r=e("./bundles/oroui/js/mediator.js"),a=e("./bundles/oroui/js/tools.js");return n.extend({options:{dialogWidgetAlias:null,getAppliedCouponsDataRoute:"oro_promotion_get_applied_coupons_data",sourceCouponIdDataAttribute:"source-coupon-id",selectors:{hiddenCollection:'[data-role="hidden-collection"]',appliedCouponElement:'[data-role="applied-coupon-element"]',couponCodeField:'[data-role="applied-coupon-code"]',sourcePromotionIdField:'[data-role="applied-coupon-source-promotion-id"]',sourceCouponIdField:'[data-role="applied-coupon-source-coupon-id"]',addedCouponsField:'[data-role="added-coupons-field"]'}},newCollectionElementData:{prototypeString:null,prototypeName:null,lastIndex:null},requiredOptions:["dialogWidgetAlias"],constructor:function o(t){o.__super__.constructor.call(this,t)},initialize:function(o){this.options=t.extend(!0,{},this.options,o||{}),this._checkOptions();const e={};e["applied-coupon:remove"]=this.removeAppliedCoupon,e.widget_initialize=this.attachDialogListeners;const s=this.$(this.options.selectors.hiddenCollection);this.newCollectionElementData.prototypeString=s.data("prototype"),this.newCollectionElementData.prototypeName=s.data("prototype-name"),this.newCollectionElementData.lastIndex=s.data("last-index"),this.listenTo(r,e)},removeAppliedCoupon:function(o){const e=this;o=parseInt(o),this.$(this.options.selectors.appliedCouponElement).each((function(s,i){const n=t(i);parseInt(n.data(e.options.sourceCouponIdDataAttribute))===o&&n.remove()}))},attachDialogListeners:function(o){this.options.dialogWidgetAlias===o.getAlias()&&o.on("contentLoad",(()=>{o.$el.on("submit",this.onAddSubmit.bind(this,o))}))},onAddSubmit:function(o,e){e.preventDefault(),r.trigger("entry-point:order:before");const n=this,a=o.form.find(this.options.selectors.addedCouponsField).val();t.ajax({url:s.generate(this.options.getAppliedCouponsDataRoute,{couponIds:a}),type:"GET",dataType:"json",success:function(o){i.each(o,(function(o){const t=n._createNewCollectionElement(o);n.$(n.options.selectors.hiddenCollection).append(t)})),r.trigger("entry-point:order:trigger")}}),o.remove()},_createNewCollectionElement:function(o){const e=this.newCollectionElementData.prototypeString.replace(a.safeRegExp(this.newCollectionElementData.prototypeName,"ig"),this.newCollectionElementData.lastIndex),s=t(e);return s.find(this.options.selectors.couponCodeField).val(o.couponCode),s.find(this.options.selectors.sourcePromotionIdField).val(o.sourcePromotionId),s.find(this.options.selectors.sourceCouponIdField).val(o.sourceCouponId),s.data(this.options.sourceCouponIdDataAttribute,o.sourceCouponId),this.newCollectionElementData.lastIndex++,s},_checkOptions:function(){const o=this.requiredOptions.filter((o=>i.isUndefined(this.options[o])&&!this.options[o]));if(o.length)throw new TypeError("Missing required option(s): "+o.join(", "));const t=[];if(i.each(this.options.selectors,(function(o,e){o||t.push(e)})),t.length)throw new TypeError("Missing required selectors(s): "+t.join(", "))}})}.call(t,e,t,o))||(o.exports=s)},"./bundles/oropromotion/js/app/views/applied-promotion-collection-view.js":(o,t,e)=>{var s;void 0===(s=function(o){"use strict";const t=e("./bundles/oroui/js/extend/jquery.js"),s=e("./bundles/oroui/js/extend/underscore.js"),i=e("./bundles/oroui/js/app/views/base/view.js"),n=e("./bundles/oroui/js/app/views/loading-mask-view.js"),r=e("./bundles/oroui/js/mediator.js");return i.extend({options:{sourcePromotionIdDataAttribute:"source-promotion-id",sourceCouponIdDataAttribute:"source-coupon-id",delimiter:",",selectors:{appliedPromotionElement:'[data-role="applied-promotion-element"]',appliedPromotionTableRow:'[data-role="applied-discount-table-row"]',appliedPromotionActiveField:'[data-role="applied-promotion-active"]',changeActiveButton:'[data-role="applied-promotion-change-active-button"]',removeButton:'[data-role="applied-promotion-remove-button"]'}},listen:{"entry-point:order:load:before mediator":"showLoadingMask","entry-point:order:load mediator":"refreshCollectionBlock","entry-point:order:load:after mediator":"hideLoadingMask"},constructor:function o(e){this.options=t.extend(!0,{},this.options,e||{}),this._checkOptions(),o.__super__.constructor.call(this,e)},events:function(){const o={};return o["click "+this.options.selectors.changeActiveButton]="changeActiveStatus",o["click "+this.options.selectors.removeButton]="removeAppliedPromotion",o},changeActiveStatus:function(o){const e=this,s=t(o.target).closest(this.options.selectors.appliedPromotionTableRow).data(this.options.sourcePromotionIdDataAttribute);this.$(this.options.selectors.appliedPromotionElement).each((function(){if(t(this).data(e.options.sourcePromotionIdDataAttribute)===s){const o=t(this).find(e.options.selectors.appliedPromotionActiveField),s=!+o.val();o.val(+s)}})),r.trigger("entry-point:order:trigger")},removeAppliedPromotion:function(o){const e=this,s=t(o.target).closest(this.options.selectors.appliedPromotionTableRow),i=s.data(this.options.sourcePromotionIdDataAttribute),n=s.data(this.options.sourceCouponIdDataAttribute);this.$(this.options.selectors.appliedPromotionElement).each((function(){t(this).data(e.options.sourcePromotionIdDataAttribute)===i&&(t(this).remove(),r.trigger("applied-coupon:remove",n))})),r.trigger("entry-point:order:trigger")},refreshCollectionBlock:function(o){if(!s.isUndefined(o.appliedPromotions)){const e=t(o.appliedPromotions);this.$el.html(e.html()),this.$el.trigger("content:changed"),this._removeLoadingMask()}},showLoadingMask:function(){this._ensureLoadingMaskLoaded(),this.subview("loadingMask").isShown()||this.subview("loadingMask").show()},hideLoadingMask:function(){this._ensureLoadingMaskLoaded(),this.subview("loadingMask").isShown()&&this.subview("loadingMask").hide()},_ensureLoadingMaskLoaded:function(){this.subview("loadingMask")||this.subview("loadingMask",new n({container:this.$el}))},_removeLoadingMask:function(){this.subview("loadingMask")&&this.removeSubview("loadingMask")},_checkOptions:function(){const o=[];if(s.each(this.options.selectors,(function(t,e){t||o.push(e)})),o.length)throw new TypeError("Missing required selectors(s): "+o.join(", "))}})}.call(t,e,t,o))||(o.exports=s)},"./bundles/oropromotion/js/app/views/coupon-add-view.js":(o,t,e)=>{var s;void 0===(s=function(o){"use strict";const t=e("./bundles/oroui/js/extend/jquery.js"),s=e("./bundles/oroui/js/extend/underscore.js"),i=e("./bundles/fosjsrouting/js/router.js"),n=e("./bundles/orotranslation/js/translator.js"),r=e("./bundles/oroui/js/app/views/base/view.js"),a=e("./bundles/oroui/js/app/views/loading-mask-view.js"),l=e("./bundles/oroui/js/widget/widget-manager.js"),u=e("../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/oropromotion/templates/field-errors.html");return r.extend({options:{entityClass:null,entityId:null,getAddedCouponsTableRoute:"oro_promotion_get_added_coupons_table",validateCouponApplicabilityRoute:"oro_promotion_validate_coupon_applicability",delimiter:",",skipMaskView:!1,selectors:{couponAutocompleteSelector:null,couponAddButtonSelector:null,addedIdsSelector:null,addedCouponsContainerSelector:null,removeCouponButtonSelector:"[data-remove-coupon-id]",selectCouponValidationContainerSelector:null,formSelector:null}},requiredOptions:["entityClass"],constructor:function o(e){this.options=t.extend(!0,{},this.options,e||{}),this._checkOptions(),o.__super__.constructor.call(this,e)},initialize:function(){this._updateApplyButtonState()},events:function(){const o={};return o["change "+this.options.selectors.addedIdsSelector]="refreshAddedCouponsTable",o["change "+this.options.selectors.couponAutocompleteSelector]="clearErrors",o["click "+this.options.selectors.couponAddButtonSelector]="addCoupon",o["click "+this.options.selectors.removeCouponButtonSelector]="removeCoupon",o},addCoupon:function(o){o.preventDefault();const e=this.$(this.options.selectors.couponAutocompleteSelector),r=this.$(this.options.selectors.addedIdsSelector),a=e.val();if(!a)return;const l=t(this.options.selectors.formSelector).find(":input[data-ftid]").serializeArray();s.each({couponId:a,addedCouponIds:r.val(),entityClass:this.options.entityClass,entityId:this.options.entityId},(function(o,t){l.push({name:t,value:o})})),this._showLoadingMask();const c=this;t.ajax({url:i.generate(this.options.validateCouponApplicabilityRoute),type:"POST",data:l,dataType:"json",success:function(o){if(c.clearErrors(),o.success){let o=r.val().split(c.options.delimiter).concat([a]);o=s.filter(o,(function(o){return""!==o})),c._updateState(o),e.val(null).trigger("change")}else{c._hideLoadingMask();const t=s.map(o.errors,(function(o){return n(o)}));c.$(c.options.selectors.selectCouponValidationContainerSelector).html(u({messages:t}))}}})},removeCoupon:function(o){const e=t(o.target).data("remove-coupon-id");let i=this.$(this.options.selectors.addedIdsSelector).val().split(this.options.delimiter);i=s.filter(i,(function(o){return""!==o&&e!==parseInt(o)})),this._updateState(i)},refreshAddedCouponsTable:function(){const o=this.$(this.options.selectors.addedCouponsContainerSelector);this._showLoadingMask(),t.ajax({url:i.generate(this.options.getAddedCouponsTableRoute,{addedCouponIds:this.$(this.options.selectors.addedIdsSelector).val()}),type:"GET",dataType:"json",success:o.html.bind(o)}).always(this._hideLoadingMask.bind(this))},clearErrors:function(){this.$(this.options.selectors.selectCouponValidationContainerSelector).html("")},_updateState:function(o){const t=this.$(this.options.selectors.addedIdsSelector),e=s.uniq(o.sort(),!0).join(this.options.delimiter);t.val()!==e&&(t.val(e).trigger("change"),this._updateApplyButtonState())},_updateApplyButtonState:function(){const o=this.$el.closest("[data-wid]"),e=this.$(this.options.selectors.addedIdsSelector);if(o.length){const s=o.data("wid");l.getWidgetInstance(s,(function(o){o.getAction("form_submit","adopted",(function(o){e.val()?t(o).removeAttr("disabled"):t(o).attr("disabled","disabled")}))}))}},_showLoadingMask:function(){this.options.skipMaskView||(this._ensureLoadingMaskLoaded(),this.subview("loadingMask").isShown()||this.subview("loadingMask").show())},_hideLoadingMask:function(){this._ensureLoadingMaskLoaded(),this.subview("loadingMask").isShown()&&this.subview("loadingMask").hide()},_ensureLoadingMaskLoaded:function(){this.subview("loadingMask")||this.subview("loadingMask",new a({container:this.$el}))},_checkOptions:function(){const o=this.requiredOptions.filter((o=>s.isUndefined(this.options[o])&&!this.options[o]));if(o.length)throw new TypeError("Missing required option(s): "+o.join(", "));const t=[];if(s.each(this.options.selectors,(function(o,e){o||t.push(e)})),t.length)throw new TypeError("Missing required selectors(s): "+t.join(", "))}})}.call(t,e,t,o))||(o.exports=s)},"./bundles/oropromotion/js/app/views/coupon-generation-preview-view.js":(o,t,e)=>{var s;void 0===(s=function(o){"use strict";const t=e("./bundles/oroui/js/extend/underscore.js"),s=e("./bundles/oroui/js/extend/jquery.js"),i=e("./bundles/fosjsrouting/js/router.js");return e("./bundles/oroui/js/app/views/base/view.js").extend({options:{routeName:"oro_promotion_coupon_generation_preview",codePreviewSelector:"#coupon-code-preview"},events:{"change .promotion-coupon-generation-preview":"onFormFieldChange"},constructor:function o(t){o.__super__.constructor.call(this,t)},initialize:function(o){this.options=t.extend({},this.options,o)},onFormFieldChange:function(o){const t=this;s(o.target).is(s(o.currentTarget))&&s.ajax({method:"POST",url:i.generate(this.options.routeName),data:this.$el.serialize(),success:function(o){o.error||s(t.options.codePreviewSelector).html(o.code)}})}})}.call(t,e,t,o))||(o.exports=s)},"./bundles/oropromotion/js/app/views/discount-options-view.js":(o,t,e)=>{var s;void 0===(s=function(o){"use strict";const t=e("./bundles/oroui/js/extend/jquery.js"),s=e("./bundles/oroui/js/app/views/base/view.js"),i=e("./bundles/oroui/js/mediator.js"),n=s.extend({options:{selectors:{formContainerSelector:'[data-role="discount-options-form"]',formTypesChoiceSelector:'[data-role="discount-form-choice"]'}},$formContainer:null,constructor:function o(t){o.__super__.constructor.call(this,t)},initialize:function(o){this.options=t.extend(!0,{},this.options,o||{});const e=this.options.el;this.$formContainer=e.find(this.options.selectors.formContainerSelector),e.on("change",this.options.selectors.formTypesChoiceSelector,this.changeDiscountForm.bind(this))},changeDiscountForm:function(o){const e=t(o.target).val();this.$formContainer.trigger("content:remove").html(this.options.discountFormPrototypes[e]).trigger("content:changed"),i.execute("layout:init",this.$formContainer)},dispose:function(){this.disposed||(delete this.$formContainer,n.__super__.dispose.call(this))}});return n}.call(t,e,t,o))||(o.exports=s)},"./bundles/oropromotion/js/app/views/type-value-switcher.js":(o,t,e)=>{var s;void 0===(s=function(o){"use strict";const t=e("./bundles/oroui/js/extend/jquery.js"),s=e("./bundles/oroui/js/extend/underscore.js"),i=e("./bundles/oroui/js/app/views/base/view.js").extend({$type:null,$amountDiscountValue:null,$percentDiscountValue:null,options:{type_selector:null,amount_discount_value_selector:null,percent_discount_value_selector:null,control_group_selector:".control-group",amount_type_value:null,percent_type_value:null},requiredOptions:["type_selector","amount_discount_value_selector","percent_discount_value_selector","amount_type_value","percent_type_value"],constructor:function o(t){o.__super__.constructor.call(this,t)},initialize:function(o){this.options=t.extend(!0,{},this.options,o||{});const e=this.requiredOptions.filter((o=>s.isUndefined(this.options[o])||s.isNull(this.options[o])));if(e.length)throw new TypeError("Missing required option(s): "+e.join(", "));const i=this.options.el;this.$type=i.find(this.options.type_selector),this.$amountDiscountValue=i.find(this.options.amount_discount_value_selector),this.$percentDiscountValue=i.find(this.options.percent_discount_value_selector),this.options.el.on("change",this.options.type_selector,this.switchValues.bind(this))},switchValues:function(){this.options.amount_type_value===this.$type.val()?(this.$amountDiscountValue.removeClass("hide"),this.$amountDiscountValue.closest(this.options.control_group_selector).removeClass("hide").show(),this.$percentDiscountValue.closest(this.options.control_group_selector).hide(),this.$percentDiscountValue.attr("value","")):this.options.percent_type_value===this.$type.val()&&(this.$percentDiscountValue.removeClass("hide"),this.$percentDiscountValue.closest(this.options.control_group_selector).removeClass("hide").show(),this.$amountDiscountValue.closest(this.options.control_group_selector).hide(),this.$amountDiscountValue.attr("value",""))},dispose:function(){this.disposed||(delete this.$type,delete this.$amountDiscountValue,delete this.$percentDiscountValue,delete this.requiredOptions,i.__super__.dispose.call(this))}});return i}.call(t,e,t,o))||(o.exports=s)}}]);